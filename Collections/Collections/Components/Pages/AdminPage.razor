@page "/admin"
@using Components.TestData

<PageTitle>Admin dashboard</PageTitle>
<div class="container-xxl py-3">
    <form method="post">
        <div class="d-flex justify-content-start m-0 row col-md row-cols-md-auto gap-1">
            <button class="btn btn-outline-dark btn-sm text-nowrap"
                    asp-formaction="Block" name="Block"
                    type="submit" value="true">
                <i class="bi bi-lock-fill"></i> Block
            </button>
            <button class="btn btn-outline-dark btn-sm text-nowrap"
                    asp-formaction="Unblock"
                    name="Unblock" type="submit" value="true">
                <i class="bi bi-unlock-fill"></i> Unblock
            </button>
            <button class="btn btn-outline-dark btn-sm text-nowrap"
                    asp-formaction="AddToAdmins"
                    name="AddToAdmins" type="submit" value="true">
                <i class="bi bi-person-fill-add"></i> Add to admins
            </button>
            <button class="btn btn-outline-dark btn-sm text-nowrap"
                    asp-formaction="RemoveFromAdmins"
                    name="RemoveFromAdmins" type="submit" value="true">
                <i class="bi bi-person-fill-dash"></i> Remove from admins
            </button>
            <button class="btn btn-danger btn-sm text-nowrap "
                    asp-formaction="Delete" name="Delete"
                    type="submit" value="true">
                <i class="bi bi-trash3-fill"></i>
            </button>
        </div>
        <div class="d-flex table-responsive pt-3">
            <table class="table table-hover table-striped table-bordered rounded-2 overflow-hidden">
                <thead class="table-secondary">
                    <tr>
                        <th scope="col">
                            <div class="form-check">
                                <input class="form-check-input text-body"
                                       type="checkbox" onClick="toggle(this)"
                                       value="" id="flexCheckDefault">
                                <label class="form-check-label"
                                       for="flexCheckDefault">
                                </label>
                            </div>
                        </th>
                        <th scope="col">Id</th>
                        <th scope="col">Name</th>
                        <th scope="col">E-mail</th>
                        <th scope="col" class="text-end">
                            Last login time (UTC)
                        </th>
                        <th scope="col" class="text-end">
                            Registration time (UTC)
                        </th>
                        <th scope="col">Role</th>
                        <th scope="col">Status</th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < users.Count(); i++)
                    {
                        <tr>
                            <td>
                                <div class="form-check">
                                    <input asp-formaction="RequestResult"
                                           class="form-check-input"
                                           type="checkbox"
                                           name="row" value="44"
                                           id="flexCheck@(i)">
                                    <label class="form-check-label"
                                           for="flexCheckDefault">
                                    </label>
                                </div>
                            </td>
                            @if (users[i].Status == false)
                            {
                                <th scope="row"
                                    class="text-secondary text-opacity-50">
                                    @(i + 1)
                                </th>
                                <td class="text-secondary text-opacity-50">
                                    @users[i].Name
                                </td>
                                <td class="text-secondary text-opacity-50">
                                    @users[i].Email
                                </td>
                                <td class="text-secondary text-opacity-50 text-end">
                                    @users[i].LastLoginDate
                                </td>
                                <td class="text-secondary text-opacity-50 text-end">
                                    @users[i].RegistrationDate
                                </td>

                                @if (users[i].IsAdmin == true)
                                {
                                    <td class="text-secondary text-opacity-50 text-end">
                                        Admin
                                    </td>
                                }
                                else
                                {
                                    <td class="text-secondary text-opacity-50 text-end">
                                        Standard
                                    </td>
                                }
                            }
                            else
                            {
                                <th scope="row">@(i + 1)</th>
                                <td>@users[i].Name</td>
                                <td>@users[i].Email</td>
                                <td class="text-end">
                                    @users[i].LastLoginDate
                                </td>
                                <td class="text-end">
                                    @users[i].RegistrationDate
                                </td>
                                @if (users[i].IsAdmin == true)
                                {
                                    <td class="text-end">
                                        Admin
                                    </td>
                                }
                                else
                                {
                                    <td class="text-end">
                                        Standard
                                    </td>
                                }
                                
                            }

                            @if (users[i].Status == false)
                            {
                                <td class="text-danger">
                                    Blocked
                                </td>
                            }
                            else if (users[i].Status == true)
                            {
                                <td class="text-success">
                                    Active
                                </td>
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </form>
</div>
<script>
    function toggle(source) {
        checkboxes = document.getElementsByName('row');
        for (var i = 0, n = checkboxes.length; i < n; i++) {
            checkboxes[i].checked = source.checked;
        }
    }
</script>

@code {
    public List<PersonModel> users = [];


    public List<PersonModel> CreateData()
    {
        DataGenerator dg = new("en");
        return dg.GenerateUsers(10, 123);
    }

    protected override async Task OnInitializedAsync()
    {
        CreateData();
        users = await Task.Run(() => CreateData());
    }

}
